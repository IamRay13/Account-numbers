<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Account Vault</title>

  <!-- SVG favicon (embedded) -->
  <link rel="icon" type="image/svg+xml"
        href='data:image/svg+xml;utf8,
        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24">
          <defs>
            <linearGradient id="g" x1="0" x2="1" y1="0" y2="1">
              <stop offset="0%" stop-color="%230b65d4"/>
              <stop offset="100%" stop-color="%231f9b85"/>
            </linearGradient>
          </defs>
          <rect x="2" y="2" width="20" height="20" rx="4" fill="url(%23g)"/>
          <path d="M7 9h10v2H7zM7 13h7v2H7z" fill="white"/>
        </svg>' />

  <meta name="color-scheme" content="light" />

  <style>
    /* Base and theme */
    :root {
      --primary: #0057D9;    /* professional blue */
      --primary-600: #0047b3;
      --accent: #00A3A3;     /* teal accent */
      --bg: #F7F9FC;         /* very light background */
      --card: #FFFFFF;
      --text: #1A1F36;       /* ink */
      --muted: #5C667A;
      --border: #E4E8F0;
      --success: #2BA84A;    /* green for toast */
      --danger: #C7362D;     /* subtle red for confirm */
      --focus: #7CC3FF;      /* focus ring */
      --shadow: 0 6px 20px rgba(26, 31, 54, 0.08);
      --radius: 14px;
      --radius-sm: 10px;
      --radius-xs: 8px;
      --gap: 16px;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--text);
      background: var(--bg);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* Layout */
    .app {
      max-width: 1100px;
      margin: 0 auto;
      padding: 24px;
    }

    header {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 16px 20px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    .logo {
      display: grid;
      place-items: center;
      width: 40px; height: 40px;
      border-radius: 10px;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      color: white;
      font-weight: 700;
      letter-spacing: 0.5px;
      user-select: none;
    }

    .title-area {
      flex: 1;
      min-width: 200px;
    }

    .title-area h1 {
      font-size: 1.25rem;
      margin: 0;
    }
    .title-area p {
      margin: 2px 0 0;
      color: var(--muted);
      font-size: 0.95rem;
    }

    .actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 14px;
      border-radius: var(--radius-xs);
      border: 1px solid var(--border);
      background: #fff;
      color: var(--text);
      font-weight: 600;
      cursor: pointer;
      transition: box-shadow .15s ease, transform .05s ease, border-color .15s ease, background .15s ease;
      box-shadow: 0 1px 0 rgba(0,0,0,0.02);
    }
    .btn:hover { border-color: #d6dbe6; }
    .btn:active { transform: translateY(1px); }
    .btn-primary {
      background: var(--primary);
      color: #fff;
      border-color: var(--primary);
    }
    .btn-primary:hover { background: var(--primary-600); border-color: var(--primary-600); }
    .btn-ghost {
      background: transparent;
      border-color: transparent;
    }

    .btn .icon { width: 18px; height: 18px; }

    /* Search with clear x */
    .search-wrap {
      position: relative;
      flex: 1 1 320px;
      min-width: 240px;
    }
    .search-input {
      width: 100%;
      padding: 12px 36px 12px 40px;
      border-radius: var(--radius-xs);
      border: 1px solid var(--border);
      background: #fff;
      box-shadow: inset 0 1px 0 rgba(0,0,0,0.02);
      font-size: 0.95rem;
    }
    .search-input:focus {
      outline: none;
      border-color: var(--focus);
      box-shadow: 0 0 0 4px rgba(124, 195, 255, 0.35);
    }
    .search-icon {
      position: absolute; left: 10px; top: 50%; transform: translateY(-50%);
      width: 18px; height: 18px; color: var(--muted);
      pointer-events: none;
    }
    .clear-btn {
      position: absolute; right: 10px; top: 50%; transform: translateY(-50%);
      width: 20px; height: 20px;
      display: grid; place-items: center;
      border: none; border-radius: 6px;
      background: #f0f3f8; color: var(--muted);
      cursor: pointer;
    }
    .clear-btn:hover { background: #e7ebf3; }

    /* Toolbar */
    .toolbar {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      padding: 12px 2px;
      color: var(--muted);
      font-size: 0.9rem;
    }
    .sort-select {
      padding: 10px 12px;
      border-radius: var(--radius-xs);
      border: 1px solid var(--border);
      background: #fff;
      min-width: 220px;
    }

    /* Cards list */
    .list {
      margin-top: 16px;
      display: grid;
      grid-template-columns: 1fr;
      gap: var(--gap);
    }

    @media (min-width: 900px) {
      .list {
        grid-template-columns: 1fr 1fr; /* two columns on desktop */
      }
    }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px;
      display: grid;
      grid-template-columns: 1fr 1fr auto;
      grid-template-areas:
        "label value actions";
      align-items: center;
      gap: 12px;
      transition: border-color .15s ease, transform .05s ease;
    }
    .card:hover { border-color: #d6dbe6; }

    .kv {
      display: grid;
      gap: 6px;
    }
    .kv .label {
      font-weight: 700;
      color: var(--text);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
    }
    .kv .value {
      color: var(--muted);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      background: #f6f8fb;
      padding: 8px 10px;
      border-radius: var(--radius-xs);
      cursor: pointer;
      word-break: break-all;
    }

    .actions-col {
      display: flex;
      gap: 8px;
      justify-content: end;
    }
    .icon-btn {
      width: 36px; height: 36px;
      display: grid; place-items: center;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: #fff;
      cursor: pointer;
      transition: border-color .15s ease, transform .05s ease;
    }
    .icon-btn:hover { border-color: #d6dbe6; }
    .icon-btn:active { transform: translateY(1px); }
    .icon { width: 18px; height: 18px; color: var(--muted); }

    /* Toast */
    .toast {
      position: fixed;
      left: 50%;
      bottom: 20px;
      transform: translateX(-50%) translateY(20px);
      background: var(--success);
      color: #fff;
      padding: 12px 16px;
      border-radius: 12px;
      box-shadow: 0 10px 24px rgba(43, 168, 74, 0.3);
      opacity: 0;
      pointer-events: none;
      transition: opacity .18s ease, transform .18s ease;
      font-weight: 700;
    }
    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    /* Dialogs */
    dialog {
      border: none;
      border-radius: var(--radius);
      width: min(560px, 96vw);
      padding: 0;
      box-shadow: var(--shadow);
    }
    dialog::backdrop { background: rgba(26, 31, 54, 0.35); }

    .modal {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
    }
    .modal header {
      box-shadow: none;
      border-radius: 0;
      border-bottom: 1px solid var(--border);
    }
    .modal .content {
      padding: 16px;
      display: grid;
      gap: 12px;
    }
    .field {
      display: grid;
      gap: 6px;
    }
    .field label { font-weight: 600; }
    .field input {
      padding: 10px 12px;
      border-radius: var(--radius-xs);
      border: 1px solid var(--border);
      background: #fff;
    }
    .field input:focus {
      outline: none;
      border-color: var(--focus);
      box-shadow: 0 0 0 4px rgba(124, 195, 255, 0.35);
    }
    .modal footer {
      padding: 12px 16px;
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      border-top: 1px solid var(--border);
      background: #fafbfe;
    }

    /* Empty state */
    .empty {
      padding: 32px;
      text-align: center;
      color: var(--muted);
    }

    /* Small helper text */
    .hint {
      color: var(--muted);
      font-size: 0.9rem;
    }

    /* Accessibility: focus visible */
    :focus-visible {
      outline: none;
      box-shadow: 0 0 0 4px rgba(124, 195, 255, 0.35);
      border-color: var(--focus);
    }
  </style>
</head>
<body>
  <div class="app" id="app">
    <header aria-label="Application header">
      <div class="logo" aria-hidden="true">AV</div>
      <div class="title-area">
        <h1>Account Vault</h1>
        <p>Store labels and account numbers. Tap either side to copy. Import/Export JSON. Local storage persists.</p>
      </div>
      <div class="actions">
        <button class="btn btn-primary" id="addBtn" title="Add (Shortcut: A)">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M12 5v14M5 12h14" stroke-width="2" stroke-linecap="round" />
          </svg>
          Add
        </button>
        <button class="btn" id="exportBtn" title="Export (Shortcut: E)">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M12 16V4M12 4l-4 4M12 4l4 4" stroke-width="2" stroke-linecap="round"/>
            <path d="M4 20h16" stroke-width="2" stroke-linecap="round"/>
          </svg>
          Export
        </button>
        <button class="btn" id="importBtn" title="Import (Shortcut: I)">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M12 8v12M12 20l-4-4M12 20l4-4" stroke-width="2" stroke-linecap="round"/>
            <path d="M4 4h16" stroke-width="2" stroke-linecap="round"/>
          </svg>
          Import
        </button>
      </div>
    </header>

    <div class="toolbar" aria-label="Search and sort toolbar">
      <div class="search-wrap">
        <input id="searchInput" class="search-input" type="search" placeholder="Search labels or account numbers…" aria-label="Search" />
        <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
          <circle cx="11" cy="11" r="7" stroke-width="2"/>
          <path d="M20 20l-4-4" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <button id="clearSearch" class="clear-btn" aria-label="Clear search">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M6 6l12 12M18 6L6 18" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </div>

      <select id="sortSelect" class="sort-select" aria-label="Sort options">
        <option value="label">Sort by label (A–Z)</option>
        <option value="updated">Sort by last updated</option>
      </select>
      <span class="hint">Shortcuts: A = Add, E = Export, I = Import</span>
    </div>

    <section id="list" class="list" aria-live="polite">
      <!-- Cards render here -->
    </section>

    <div id="empty" class="empty" hidden>
      No records yet. Press Add or use shortcut A.
    </div>

    <div id="toast" class="toast" role="status" aria-live="polite">Copied</div>

    <!-- Hidden import input -->
    <input id="importFile" type="file" accept=".json,application/json" hidden />

    <!-- Add/Edit dialog -->
    <dialog id="entryDialog">
      <div class="modal" role="dialog" aria-labelledby="dialogTitle">
        <header>
          <div class="title-area">
            <h1 id="dialogTitle">Add entry</h1>
            <p id="dialogSubtitle" class="hint">Enter label and account number.</p>
          </div>
          <div class="actions">
            <button class="btn btn-ghost" id="closeDialogBtn" aria-label="Close">
              <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M6 6l12 12M18 6L6 18" stroke-width="2" stroke-linecap="round"/>
              </svg>
              Close
            </button>
          </div>
        </header>

        <div class="content">
          <div class="field">
            <label for="bankNameInput">Label</label>
            <input id="bankNameInput" type="text" placeholder="e.g., PLDT Account number" />
          </div>
          <div class="field">
            <label for="accountNumberInput">Account number</label>
            <input id="accountNumberInput" type="text" placeholder="e.g., 123456789" />
          </div>
        </div>
        <footer>
          <button class="btn" id="deleteBtn" hidden>
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path d="M6 7h12M9 7V5h6v2M7 7l1 12h8l1-12" stroke-width="2" stroke-linecap="round"/>
            </svg>
            Delete
          </button>
          <button class="btn btn-primary" id="saveBtn">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path d="M5 13l4 4L19 7" stroke-width="2" stroke-linecap="round"/>
            </svg>
            Save
          </button>
        </footer>
      </div>
    </dialog>
  </div>

  <script>
    // Storage keys
    const STORAGE_KEY = 'accountVault.items';
    const STORAGE_SORT = 'accountVault.sort';

    // State
    let items = [];
    let sortMode = localStorage.getItem(STORAGE_SORT) || 'label';
    let editingId = null;

    // Elements
    const listEl = document.getElementById('list');
    const emptyEl = document.getElementById('empty');
    const toastEl = document.getElementById('toast');
    const addBtn = document.getElementById('addBtn');
    const exportBtn = document.getElementById('exportBtn');
    const importBtn = document.getElementById('importBtn');
    const importFile = document.getElementById('importFile');
    const searchInput = document.getElementById('searchInput');
    const clearSearch = document.getElementById('clearSearch');
    const sortSelect = document.getElementById('sortSelect');
    const entryDialog = document.getElementById('entryDialog');
    const bankNameInput = document.getElementById('bankNameInput');
    const accountNumberInput = document.getElementById('accountNumberInput');
    const saveBtn = document.getElementById('saveBtn');
    const deleteBtn = document.getElementById('deleteBtn');
    const closeDialogBtn = document.getElementById('closeDialogBtn');
    const dialogTitle = document.getElementById('dialogTitle');

    // Utils
    const uid = () => {
      // Compact random id
      const s = Math.random().toString(36).slice(2, 10).toUpperCase();
      const t = Date.now().toString(36).toUpperCase().slice(-6);
      return s + t;
    };

    const nowISO = () => new Date().toISOString();

    const formatExportName = () => {
      const d = new Date();
      // Use local date YYYY-MM-DD (Phoenix local)
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth() + 1).padStart(2, '0');
      const dd = String(d.getDate()).padStart(2, '0');
      return `account-vault-${yyyy}-${mm}-${dd}.json`;
    };

    const saveLocal = () => {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(items));
      localStorage.setItem(STORAGE_SORT, sortMode);
    };

    const loadLocal = () => {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        items = raw ? JSON.parse(raw) : [];
        // Backfill updatedAt
        items.forEach(it => {
          if (!it.updatedAt) it.updatedAt = nowISO();
        });
      } catch {
        items = [];
      }
    };

    const showToast = (msg) => {
      toastEl.textContent = msg;
      toastEl.classList.add('show');
      setTimeout(() => toastEl.classList.remove('show'), 1400);
    };

    const copyText = async (text) => {
      try {
        await navigator.clipboard.writeText(text);
        showToast('Copied to clipboard');
      } catch {
        // Fallback for older iOS: temporary input select + copy
        const t = document.createElement('textarea');
        t.value = text;
        document.body.appendChild(t);
        t.select();
        document.execCommand('copy');
        document.body.removeChild(t);
        showToast('Copied to clipboard');
      }
    };

    const sortItems = (arr) => {
      if (sortMode === 'label') {
        return [...arr].sort((a, b) =>
          a.bankName.localeCompare(b.bankName, undefined, { sensitivity: 'base' })
        );
      }
      if (sortMode === 'updated') {
        return [...arr].sort((a, b) =>
          new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime()
        );
      }
      return arr;
    };

    const render = () => {
      const term = searchInput.value.trim().toLowerCase();
      const data = sortItems(items).filter(it => {
        if (!term) return true;
        return (
          it.bankName.toLowerCase().includes(term) ||
          it.accountNumber.toLowerCase().includes(term)
        );
      });

      listEl.innerHTML = '';
      if (data.length === 0) {
        emptyEl.hidden = false;
        return;
      }
      emptyEl.hidden = true;

      for (const it of data) {
        const card = document.createElement('div');
        card.className = 'card';
        card.dataset.id = it.id;

        // Label column
        const labelCol = document.createElement('div');
        labelCol.className = 'kv';
        const labelDiv = document.createElement('div');
        labelDiv.className = 'label';
        labelDiv.title = 'Tap to copy label';
        labelDiv.innerHTML = `
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
            <path d="M4 7h13l3 3v7a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V7z" stroke-width="2"/>
          </svg>
          ${escapeHTML(it.bankName)}
        `;
        labelDiv.addEventListener('click', () => copyText(it.bankName));
        labelCol.appendChild(labelDiv);

        // Value column
        const valueCol = document.createElement('div');
        valueCol.className = 'kv';
        const valueDiv = document.createElement('div');
        valueDiv.className = 'value';
        valueDiv.title = 'Tap to copy account number';
        valueDiv.textContent = it.accountNumber;
        valueDiv.addEventListener('click', () => copyText(it.accountNumber));
        valueCol.appendChild(valueDiv);

        // Actions column
        const actions = document.createElement('div');
        actions.className = 'actions-col';

        const editBtn = document.createElement('button');
        editBtn.className = 'icon-btn';
        editBtn.title = 'Edit';
        editBtn.innerHTML = `
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M4 20h4l10-10-4-4L4 16v4z" stroke-width="2" stroke-linecap="round"/>
          </svg>
        `;
        editBtn.addEventListener('click', () => openEdit(it.id));

        const delBtn = document.createElement('button');
        delBtn.className = 'icon-btn';
        delBtn.title = 'Delete';
        delBtn.innerHTML = `
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M6 7h12M9 7V5h6v2M7 7l1 12h8l1-12" stroke-width="2" stroke-linecap="round"/>
          </svg>
        `;
        delBtn.addEventListener('click', () => confirmDelete(it.id));

        actions.appendChild(editBtn);
        actions.appendChild(delBtn);

        card.appendChild(labelCol);
        card.appendChild(valueCol);
        card.appendChild(actions);

        listEl.appendChild(card);
      }
    };

    const escapeHTML = (str) =>
      str.replace(/[&<>"']/g, m => ({
        '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'
      })[m]);

    // Dialog handling
    const openAdd = () => {
      editingId = null;
      dialogTitle.textContent = 'Add entry';
      deleteBtn.hidden = true;
      bankNameInput.value = '';
      accountNumberInput.value = '';
      entryDialog.showModal();
      setTimeout(() => bankNameInput.focus(), 50);
    };

    const openEdit = (id) => {
      const it = items.find(x => x.id === id);
      if (!it) return;
      editingId = id;
      dialogTitle.textContent = 'Edit entry';
      deleteBtn.hidden = false;
      bankNameInput.value = it.bankName;
      accountNumberInput.value = it.accountNumber;
      entryDialog.showModal();
      setTimeout(() => bankNameInput.focus(), 50);
    };

    const closeDialog = () => {
      entryDialog.close();
      editingId = null;
    };

    const saveEntry = () => {
      const bankName = bankNameInput.value.trim();
      const accountNumber = accountNumberInput.value.trim();
      if (!bankName || !accountNumber) {
        showToast('Please enter both fields');
        return;
      }
      if (editingId) {
        const idx = items.findIndex(x => x.id === editingId);
        if (idx >= 0) {
          items[idx].bankName = bankName;
          items[idx].accountNumber = accountNumber;
          items[idx].updatedAt = nowISO();
        }
        showToast('Entry updated');
      } else {
        items.push({
          id: uid(),
          bankName,
          accountNumber,
          updatedAt: nowISO()
        });
        showToast('Entry added');
      }
      saveLocal();
      render();
      closeDialog();
    };

    const confirmDelete = (id) => {
      const it = items.find(x => x.id === id);
      if (!it) return;
      // Inline confirm using the edit dialog for consistent UI
      openEdit(id);
      // Replace delete behavior to confirm then delete
      deleteBtn.onclick = () => {
        const ok = confirm(`Delete "${it.bankName}"?`);
        if (!ok) return;
        items = items.filter(x => x.id !== id);
        saveLocal();
        render();
        closeDialog();
        showToast('Entry deleted');
      };
    };

    // Import / Export
    const exportJSON = () => {
      // Only include fields according to the required format (id, bankName, accountNumber)
      const payload = items.map(({ id, bankName, accountNumber }) => ({ id, bankName, accountNumber }));
      const blob = new Blob([JSON.stringify(payload, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = formatExportName(); // filename should be date today
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
      showToast('Exported');
    };

    const importJSON = async (file) => {
      const text = await file.text();
      let data;
      try {
        data = JSON.parse(text);
      } catch {
        showToast('Invalid JSON');
        return;
      }
      if (!Array.isArray(data)) {
        showToast('JSON must be an array');
        return;
      }
      // Validate format: id, bankName, accountNumber
      const valid = [];
      for (const row of data) {
        if (
          row &&
          typeof row.id === 'string' &&
          typeof row.bankName === 'string' &&
          typeof row.accountNumber === 'string'
        ) {
          valid.push({
            id: row.id,
            bankName: row.bankName,
            accountNumber: row.accountNumber,
            updatedAt: nowISO()
          });
        }
      }
      if (valid.length === 0) {
        showToast('No valid records found');
        return;
      }
      // Merge: replace existing by id, add new
      const byId = new Map(items.map(x => [x.id, x]));
      for (const v of valid) {
        byId.set(v.id, v);
      }
      items = Array.from(byId.values());
      saveLocal();
      render();
      showToast('Imported');
    };

    // Event wiring
    addBtn.addEventListener('click', openAdd);
    exportBtn.addEventListener('click', exportJSON);
    importBtn.addEventListener('click', () => importFile.click());
    importFile.addEventListener('change', (e) => {
      const file = e.target.files?.[0];
      if (file) importJSON(file);
      importFile.value = '';
    });

    saveBtn.addEventListener('click', saveEntry);
    closeDialogBtn.addEventListener('click', closeDialog);
    entryDialog.addEventListener('cancel', (e) => { e.preventDefault(); closeDialog(); });

    searchInput.addEventListener('input', render);
    clearSearch.addEventListener('click', () => {
      searchInput.value = '';
      searchInput.focus();
      render();
    });

    sortSelect.value = sortMode;
    sortSelect.addEventListener('change', () => {
      sortMode = sortSelect.value;
      saveLocal();
      render();
    });

    // Keyboard shortcuts: A (Add), E (Export), I (Import)
    document.addEventListener('keydown', (e) => {
      // Ignore when typing in inputs/dialogs
      const active = document.activeElement;
      const isTyping = active && (active.tagName === 'INPUT' || active.tagName === 'TEXTAREA');
      const isDialogOpen = entryDialog.open;
      if (isTyping || isDialogOpen) return;

      if (e.key === 'a' || e.key === 'A') {
        e.preventDefault();
        openAdd();
      } else if (e.key === 'e' || e.key === 'E') {
        e.preventDefault();
        exportJSON();
      } else if (e.key === 'i' || e.key === 'I') {
        e.preventDefault();
        importFile.click();
      }
    });

    // Initial load
    loadLocal();
    render();

    // Service worker friendly: no external files required
  </script>
</body>
</html>
